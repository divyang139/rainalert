{% extends "base.html" %}

{% block title %}Verify OTP - DayFlow HRMS{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6 col-lg-5">
            <div class="card shadow">
                <div class="card-body p-5">
                    <div class="text-center mb-4">
                        <i class="fas fa-shield-alt fa-3x text-primary mb-3"></i>
                        <h3 class="card-title">Verify OTP</h3>
                        <p class="text-muted">
                            We've sent a verification code to<br>
                            <strong>{{ email }}</strong>
                        </p>
                    </div>

                    <form method="POST" action="{{ url_for('auth.verify_otp') }}">
                        <div class="mb-4">
                            <label for="otp" class="form-label">Enter OTP Code</label>
                            <input type="text" 
                                   class="form-control form-control-lg text-center" 
                                   id="otp" 
                                   name="otp" 
                                   maxlength="6"
                                   pattern="[0-9]{6}"
                                   placeholder="000000"
                                   required 
                                   autofocus
                                   style="letter-spacing: 8px; font-size: 24px;">
                            <small class="form-text text-muted">
                                Enter the 6-digit code sent to your email
                            </small>
                        </div>

                        <button type="submit" class="btn btn-primary w-100 mb-3">
                            <i class="fas fa-check-circle"></i> Verify OTP
                        </button>
                    </form>

                    <div class="text-center">
                        <p class="mb-2">Didn't receive the code?</p>
                        <form method="POST" action="{{ url_for('auth.resend_otp') }}" class="d-inline">
                            <button type="submit" class="btn btn-link p-0">
                                <i class="fas fa-redo"></i> Resend OTP
                            </button>
                        </form>
                    </div>

                    <hr class="my-4">

                    <div class="text-center">
                        <a href="{{ url_for('auth.login') }}" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left"></i> Back to Login
                        </a>
                    </div>
                </div>
            </div>

            <div class="card mt-3 border-warning">
                <div class="card-body py-2">
                    <small class="text-muted">
                        <i class="fas fa-info-circle text-warning"></i>
                        The OTP is valid for {{ config.OTP_EXPIRY_MINUTES or 10 }} minutes. 
                        For security, do not share this code with anyone.
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* Remove spinner arrows from number input */
    input[type="text"]#otp::-webkit-outer-spin-button,
    input[type="text"]#otp::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }
    
    input[type="text"]#otp {
        -moz-appearance: textfield;
    }
    
    /* Add focus effect */
    input#otp:focus {
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
        border-color: #86b7fe;
    }
</style>

<script>
    // Auto-submit form when 6 digits are entered
    document.getElementById('otp').addEventListener('input', function(e) {
        const value = e.target.value.replace(/\D/g, ''); // Remove non-digits
        e.target.value = value;
        
        if (value.length === 6) {
            // Optional: Auto-submit after a brief delay
            setTimeout(() => {
                e.target.form.submit();
            }, 500);
        }
    });
    
    // Paste support
    document.getElementById('otp').addEventListener('paste', function(e) {
        e.preventDefault();
        const pastedData = e.clipboardData.getData('text').replace(/\D/g, '');
        e.target.value = pastedData.substring(0, 6);
        
        if (e.target.value.length === 6) {
            setTimeout(() => {
                e.target.form.submit();
            }, 500);
        }
    });
</script>
{% endblock %}
