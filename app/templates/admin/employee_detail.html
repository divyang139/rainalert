{% extends "base.html" %}

{% block title %}{{ employee.full_name }} - Employee Details - Admin{% endblock %}

{% block content %}
<div class="container" style="margin-top: 2rem;">
    <div class="page-header">
        <div>
            <a href="{{ url_for('admin.employees') }}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left"></i> Back to Employees
            </a>
        </div>
        <div style="display: flex; gap: 1rem; margin-top: 1rem;">
            <a href="{{ url_for('admin.edit_employee', employee_id=employee.id) }}" class="btn btn-primary">
                <i class="fas fa-edit"></i> Edit Employee
            </a>
            {% if employee.status == 'Active' %}
            <form method="POST" action="{{ url_for('admin.deactivate_employee', employee_id=employee.id) }}" style="display: inline;">
                <button type="submit" class="btn btn-danger" data-confirm="Are you sure you want to deactivate this employee?">
                    <i class="fas fa-user-times"></i> Deactivate
                </button>
            </form>
            {% endif %}
        </div>
    </div>

    <div class="row">
        <!-- Employee Profile -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-body text-center">
                    <div class="profile-avatar" style="width: 120px; height: 120px; margin: 0 auto 1rem; font-size: 48px;">
                        {{ employee.first_name[0] }}{{ employee.last_name[0] }}
                    </div>
                    <h2>{{ employee.full_name }}</h2>
                    <p class="text-muted">{{ employee.designation }}</p>
                    <span class="badge badge-{{ 'success' if employee.status == 'Active' else 'secondary' }}" style="font-size: 14px;">
                        {{ employee.status }}
                    </span>
                    <hr>
                    <div class="info-row">
                        <i class="fas fa-id-card"></i>
                        <div>
                            <small>Employee ID</small>
                            <strong>{{ employee.user.employee_id }}</strong>
                        </div>
                    </div>
                    <div class="info-row">
                        <i class="fas fa-envelope"></i>
                        <div>
                            <small>Email</small>
                            <strong>{{ employee.user.email }}</strong>
                        </div>
                    </div>
                    <div class="info-row">
                        <i class="fas fa-phone"></i>
                        <div>
                            <small>Phone</small>
                            <strong>{{ employee.phone }}</strong>
                        </div>
                    </div>
                    <div class="info-row">
                        <i class="fas fa-calendar"></i>
                        <div>
                            <small>Date of Birth</small>
                            <strong>{{ employee.date_of_birth.strftime('%B %d, %Y') if employee.date_of_birth else 'N/A' }}</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Employee Details -->
        <div class="col-md-8">
            <!-- Work Information -->
            <div class="card" style="margin-bottom: 1.5rem;">
                <div class="card-header">
                    <h3><i class="fas fa-briefcase"></i> Work Information</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="detail-item">
                                <label>Department</label>
                                <p>{{ employee.department }}</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="detail-item">
                                <label>Designation</label>
                                <p>{{ employee.designation }}</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="detail-item">
                                <label>Date of Joining</label>
                                <p>{{ employee.date_of_joining.strftime('%B %d, %Y') if employee.date_of_joining else 'N/A' }}</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="detail-item">
                                <label>Salary</label>
                                <p>â‚¹{{ "{:,.2f}".format(employee.salary) if employee.salary else 'N/A' }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Personal Information -->
            <div class="card" style="margin-bottom: 1.5rem;">
                <div class="card-header">
                    <h3><i class="fas fa-user"></i> Personal Information</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="detail-item">
                                <label>Gender</label>
                                <p>{{ employee.gender or 'N/A' }}</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="detail-item">
                                <label>Blood Group</label>
                                <p>{{ employee.blood_group or 'N/A' }}</p>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="detail-item">
                                <label>Address</label>
                                <p>{{ employee.address or 'N/A' }}</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="detail-item">
                                <label>Emergency Contact</label>
                                <p>{{ employee.emergency_contact or 'N/A' }}</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="detail-item">
                                <label>Emergency Contact Name</label>
                                <p>{{ employee.emergency_contact_name or 'N/A' }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="row">
                <div class="col-md-4">
                    <div class="stat-card-small">
                        <i class="fas fa-calendar-check" style="color: #4CAF50;"></i>
                        <div>
                            <h4>{{ attendance_stats.present }}</h4>
                            <p>Days Present</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stat-card-small">
                        <i class="fas fa-calendar-times" style="color: #f44336;"></i>
                        <div>
                            <h4>{{ attendance_stats.absent }}</h4>
                            <p>Days Absent</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stat-card-small">
                        <i class="fas fa-umbrella-beach" style="color: #2196F3;"></i>
                        <div>
                            <h4>{{ leave_stats.approved }}</h4>
                            <p>Leaves Taken</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Attendance -->
    <div class="card" style="margin-top: 2rem;">
        <div class="card-header">
            <h3><i class="fas fa-history"></i> Recent Attendance</h3>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Status</th>
                            <th>Check In</th>
                            <th>Check Out</th>
                            <th>Hours Worked</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for record in recent_attendance %}
                        <tr>
                            <td>{{ record.date.strftime('%B %d, %Y') }}</td>
                            <td>
                                <span class="badge badge-{{ 'success' if record.status == 'Present' else 'warning' if record.status == 'Half-day' else 'danger' if record.status == 'Absent' else 'info' }}">
                                    {{ record.status }}
                                </span>
                            </td>
                            <td>{{ record.check_in.strftime('%I:%M %p') if record.check_in else '-' }}</td>
                            <td>{{ record.check_out.strftime('%I:%M %p') if record.check_out else '-' }}</td>
                            <td>{{ record.hours_worked if record.hours_worked else '-' }}</td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="5" class="text-center text-muted">No attendance records found</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Recent Leave Requests -->
    <div class="card" style="margin-top: 2rem;">
        <div class="card-header">
            <h3><i class="fas fa-calendar-alt"></i> Recent Leave Requests</h3>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>From</th>
                            <th>To</th>
                            <th>Days</th>
                            <th>Reason</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for leave in recent_leaves %}
                        <tr>
                            <td>{{ leave.leave_type }}</td>
                            <td>{{ leave.start_date.strftime('%b %d, %Y') }}</td>
                            <td>{{ leave.end_date.strftime('%b %d, %Y') }}</td>
                            <td>{{ (leave.end_date - leave.start_date).days + 1 }}</td>
                            <td>{{ leave.reason[:50] + '...' if leave.reason|length > 50 else leave.reason }}</td>
                            <td>
                                <span class="badge badge-{{ 'warning' if leave.status == 'Pending' else 'success' if leave.status == 'Approved' else 'danger' }}">
                                    {{ leave.status }}
                                </span>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="6" class="text-center text-muted">No leave requests found</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<style>
.profile-avatar {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 40px;
}

.info-row {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem 0;
    border-bottom: 1px solid var(--border-color);
}

.info-row:last-child {
    border-bottom: none;
}

.info-row i {
    font-size: 1.5rem;
    color: var(--primary-color);
    width: 30px;
}

.info-row div {
    text-align: left;
}

.info-row small {
    display: block;
    color: var(--text-secondary);
    font-size: 0.875rem;
}

.info-row strong {
    display: block;
    color: var(--text-primary);
}

.detail-item {
    margin-bottom: 1.5rem;
}

.detail-item label {
    font-weight: 600;
    color: var(--text-secondary);
    font-size: 0.875rem;
    display: block;
    margin-bottom: 0.5rem;
}

.detail-item p {
    color: var(--text-primary);
    margin: 0;
}

.stat-card-small {
    background: var(--bg-white);
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: var(--shadow);
    display: flex;
    align-items: center;
    gap: 1rem;
}

.stat-card-small i {
    font-size: 2rem;
}

.stat-card-small h4 {
    margin: 0;
    font-size: 1.75rem;
    font-weight: 700;
}

.stat-card-small p {
    margin: 0;
    color: var(--text-secondary);
    font-size: 0.875rem;
}
</style>
{% endblock %}
